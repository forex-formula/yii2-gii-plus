#!/bin/sh

EXPECTED1="Running 'Base Model Generator'...

The following files will be generated:
  [unchanged] models/base/BlogBase.php
  [unchanged] models/query/base/BlogQueryBase.php
  [unchanged] models/base/CommentBase.php
  [unchanged] models/query/base/CommentQueryBase.php
  [unchanged] models/base/PostBase.php
  [unchanged] models/query/base/PostQueryBase.php

No files were chosen to be generated."

EXPECTED2="Running 'User Model Generator'...

The following files will be generated:
  [unchanged] models/Blog.php
  [unchanged] models/query/BlogQuery.php
  [unchanged] models/Comment.php
  [unchanged] models/query/CommentQuery.php
  [unchanged] models/Post.php
  [unchanged] models/query/PostQuery.php

No files were chosen to be generated."

DIR=$(dirname $0)

echo 'CREATE DATABASE yii2_gii_plus_tests;' | mysql
$DIR/yii migrate/up --interactive=0 > /dev/null
ACTUAL1=`$DIR/yii gii/basemodel --interactive=0 --overwrite=0`
ACTUAL2=`$DIR/yii gii/usermodel --interactive=0 --overwrite=0`
$DIR/yii migrate/down --interactive=0 > /dev/null
echo 'DROP DATABASE yii2_gii_plus_tests;' | mysql

if [ "$EXPECTED1" = "$ACTUAL1" ]; then
    echo '1 passed'
else
    echo $ACTUAL1
    exit 1
fi

if [ "$EXPECTED2" = "$ACTUAL2" ]; then
    echo '2 passed'
else
    echo $ACTUAL2
    exit 2
fi
